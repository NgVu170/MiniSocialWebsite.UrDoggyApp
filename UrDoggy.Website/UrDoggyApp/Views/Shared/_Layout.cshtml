﻿@using Microsoft.AspNetCore.Mvc
@using UrDoggy.Core.Models
@inject UrDoggy.Services.Interfaces.IFriendService FriendService
@inject UrDoggy.Services.Interfaces.INotificationService NotificationService
@inject UrDoggy.Services.Interfaces.IUserService UserService

@{
    bool isHome = ViewContext.RouteData.Values["controller"]?.ToString() == "Newsfeed"
                       && ViewContext.RouteData.Values["action"]?.ToString() == "Index";

    bool isTrending = ViewContext.RouteData.Values["controller"]?.ToString() == "Newsfeed"
                       && ViewContext.RouteData.Values["action"]?.ToString() == "Index#";

    bool isNotification = ViewContext.RouteData.Values["controller"]?.ToString() == "Notifications";
    bool isMessages = ViewContext.RouteData.Values["controller"]?.ToString() == "Messages";
    bool isDashboard = ViewContext.RouteData.Values["controller"]?.ToString() == "Admin";

    var currentUser = ViewBag.CurrentUser as User;
    int unreadCount = ViewBag.UnreadCount ?? 0;
    var friends = ViewBag.Friends as List<User> ?? new List<User>();

    bool isAdmin = currentUser?.IsAdmin ?? false;

    string currentUserAvatarUrl = string.IsNullOrWhiteSpace(currentUser?.ProfilePicture)
        ? Url.Content("~/images/default-avatar.png")
        : Url.Content(currentUser.ProfilePicture);

    bool hasLeft = IsSectionDefined("LeftSidebar");
    bool hasRight = IsSectionDefined("RightSidebar");

    string layoutClass = hasLeft && hasRight ? "layout-3"
                       : hasLeft && !hasRight ? "layout-2-left"
                       : !hasLeft && hasRight ? "layout-2-right"
                       : "layout-1";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>UrDoggy</title>

    <!-- Core libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Global Layout & Token System -->
    <link rel="stylesheet" href="~/css/layout.css" />
    <link rel="stylesheet" href="~/css/navbar.css" />

    <!-- Global Script -->
    <script src="~/js/navbar.js"></script>
    <script src="~/js/post-tagging.js"></script>

    @RenderSection("Styles", required: false)
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar-ui">
        <partial name="~/Views/Shared/Partials/Navbar/_Navbar.cshtml" />
    </nav>

    <!-- MAIN LAYOUT GRID -->
    <div class="main-layout @layoutClass">

        @* LEFT SIDEBAR *@
        @if (hasLeft)
        {
            <aside class="sidebar-ui scroll-hide">
                @RenderSection("LeftSidebar", required: false)
            </aside>
        }

        @* FEED CONTENT *@
        <main class="feed-ui scroll-hide @(isMessages ? "messages-view" : "")" style="padding: 20px">
            @RenderBody()
        </main>

        @* RIGHT SIDEBAR *@
        @if (hasRight)
        {
            <aside class="sidebar-ui scroll-hide">
                @RenderSection("RightSidebar", required: false)
            </aside>
        }
    </div>

    <!-- Scripts -->
    @RenderSection("Scripts", required: false)
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
