
@using UrDoggy.Core.Models.GroupModels
@model UrDoggy.Core.Models.GroupModels.Group

@{
    var pendingPosts = ViewBag.PendingPostList as List<GroupPostStatus>;
    var memberList = ViewBag.MemberList as List<GroupDetail>;
    var reportList = ViewBag.ReportList as List<GroupReport>;
    GroupRole role = (GroupRole)(ViewBag.Role ?? GroupRole.Member);
}

<header class="page-header">
    <h1 class="page-title">Group Management - @Model.GroupName</h1>
    <p><strong>Your Role:</strong> @role</p>
</header>

<div class="container">
    <!-- ================= PENDING POSTS ================= -->
    <h3>Pending Posts</h3>
    <hr />
    @if (pendingPosts != null && pendingPosts.Any())
    {
        foreach (var post in pendingPosts)
        {
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">
                        Post by @(post.Author?.DisplayName ?? "Unknown")
                        on @(post.UploaddAt.ToString("MM/dd/yyyy"))
                    </h5>
                    <p class="card-text">@post.Content</p>

                    @if (post.MediaItems != null)
                    {
                        foreach (var mediaItem in post.MediaItems)
                        {
                            if (mediaItem.MediaType.StartsWith("image"))
                            {
                                <img src="@mediaItem.Path" alt="Post Image" class="img-fluid mb-2" />
                            }
                            else if (mediaItem.MediaType.StartsWith("video"))
                            {
                                <video controls class="img-fluid mb-2">
                                    <source src="@mediaItem.Path" type="@mediaItem.MediaType" />
                                </video>
                            }
                        }
                    }
                </div>

                <div class="card-footer">
                    <a asp-action="ApprovePost"
                       asp-controller="Group"
                       asp-route-groupId="@Model.Id"
                       asp-route-postId="@post.Id"
                       class="btn btn-success btn-sm">Approve</a>

                    <a asp-action="RejectPost"
                       asp-controller="Group"
                       asp-route-groupId="@Model.Id"
                       asp-route-postId="@post.Id"
                       class="btn btn-danger btn-sm">Reject</a>
                </div>
            </div>
        }
    }
    else
    {
        <p>No pending posts found.</p>
    }

    <!-- ================= MEMBERS ================= -->
    <h3>Group Members</h3>
    <hr />
    @if (memberList != null && memberList.Any())
    {
        foreach (var member in memberList)
        {
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="card-title">@member.User.DisplayName</h5>
                    <p>Joined on @member.JoinedAt.ToString("MM/dd/yyyy")</p>
                    <p>Role: @member.Role</p>
                </div>
                <div class="card-body">
                    @if (member.Role == GroupRole.Member)
                    {
                        @if (role == GroupRole.Admin)
                        {
                            <a asp-action="PromoteToModerator"
                               asp-controller="Group"
                               asp-route-groupId="@Model.Id"
                               asp-route-userId="@member.UserId"
                               class="btn btn-success btn-sm">Promote</a>
                        }
                        <a asp-action="KickMember"
                           asp-controller="Group"
                           asp-route-groupId="@Model.Id"
                           asp-route-userId="@member.UserId"
                           class="btn btn-warning btn-sm"
                           onclick="return confirm('Kick this member?');">Kick</a>
                    }
                    else if (member.Role == GroupRole.Moderator && role == GroupRole.Admin)
                    {
                        <a asp-action="DemoteToMember"
                           asp-controller="Group"
                           asp-route-groupId="@Model.Id"
                           asp-route-userId="@member.UserId"
                           class="btn btn-warning btn-sm">Demote</a>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <p>No members found.</p>
    }

    <!-- ================= ADMIN OPTIONS ================= -->
    @if (role == GroupRole.Admin)
    {
        <h3>Admin Options</h3>
        <hr />
        <a asp-action="EditGroupInformation"
           asp-controller="Group"
           asp-route-groupId="@Model.Id"
           class="btn btn-primary">Edit Group Info</a>

        <a asp-action="ReleaseGroup"
           asp-controller="Group"
           asp-route-groupId="@Model.Id"
           class="btn btn-danger"
           onclick="return confirm('Are you sure you want to delete this group?');">
            Release Group
        </a>
    }
</div>
